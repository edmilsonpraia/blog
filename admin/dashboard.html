<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Blog Multilingue</title>
    
    <!-- Favicon -->
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/publications-admin.css">
    <link id="theme-style" rel="stylesheet" href="../css/themes/light.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Adicionar o script do Supabase (versão corrigida) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Função para inicializar o Supabase
        function initializeSupabase() {
            const supabaseUrl = 'https://lvegldhtgalibbkmhzfz.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx2ZWdsZGh0Z2FsaWJia21oemZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM2ODQzOTcsImV4cCI6MjA1OTI2MDM5N30.mS069eiTid0_l067PRZPD_3a7v-GJrvxQNCTCRuNpYw';
            window.supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

            if (!window.supabaseClient) {
                console.error('Erro ao inicializar o cliente Supabase');
            } else {
                console.log('Cliente Supabase inicializado com sucesso');
            }

            // Definir o BlogData para interagir com o Supabase
            window.BlogData = {
                // Buscar todos os artigos
                fetchArticles: async function() {
                    try {
                        const { data, error } = await window.supabaseClient
                            .from('articles')
                            .select('*')
                            .order('created_at', { ascending: false });
                        if (error) throw error;
                        return data || [];
                    } catch (error) {
                        console.error('Erro ao buscar artigos:', error);
                        throw error;
                    }
                },

                // Buscar todos os eventos
                fetchEvents: async function() {
                    try {
                        const { data, error } = await window.supabaseClient
                            .from('events')
                            .select('*')
                            .order('created_at', { ascending: false });
                        if (error) throw error;
                        return data || [];
                    } catch (error) {
                        console.error('Erro ao buscar eventos:', error);
                        throw error;
                    }
                },

                // Buscar todos os materiais
                fetchMaterials: async function() {
                    try {
                        const { data, error } = await window.supabaseClient
                            .from('materials')
                            .select('*')
                            .order('created_at', { ascending: false });
                        if (error) throw error;
                        return data || [];
                    } catch (error) {
                        console.error('Erro ao buscar materiais:', error);
                        throw error;
                    }
                },

                // Adicionar um novo artigo
                addArticle: async function(article) {
                    try {
                        const articleData = {
                            title: article.title,
                            date: article.date,
                            authors: article.authors,
                            category: article.category,
                            subcategory: article.subcategory,
                            journal: article.journal,
                            doi: article.doi,
                            abstract: article.abstract,
                            file_link: article.fileLink,
                            thumbnail_link: article.thumbnailLink,
                            content: article.content,
                            status: article.status,
                            language: article.language,
                            access: article.access,
                            tags: article.tags,
                            created_at: new Date().toISOString()
                        };

                        const { data, error } = await window.supabaseClient
                            .from('articles')
                            .insert([articleData])
                            .select();
                        if (error) throw error;
                        return data[0];
                    } catch (error) {
                        console.error('Erro ao adicionar artigo:', error);
                        throw error;
                    }
                },

                // Atualizar um artigo existente
                updateArticle: async function(id, article) {
                    try {
                        const articleData = {
                            title: article.title,
                            date: article.date,
                            authors: article.authors,
                            category: article.category,
                            subcategory: article.subcategory,
                            journal: article.journal,
                            doi: article.doi,
                            abstract: article.abstract,
                            file_link: article.fileLink,
                            thumbnail_link: article.thumbnailLink,
                            content: article.content,
                            status: article.status,
                            language: article.language,
                            access: article.access,
                            tags: article.tags,
                            updated_at: new Date().toISOString()
                        };

                        const { data, error } = await window.supabaseClient
                            .from('articles')
                            .update(articleData)
                            .eq('id', id)
                            .select();
                        if (error) throw error;
                        return data[0];
                    } catch (error) {
                        console.error('Erro ao atualizar artigo:', error);
                        throw error;
                    }
                },

                // Excluir um artigo
                deleteArticle: async function(id) {
                    try {
                        const { error } = await window.supabaseClient
                            .from('articles')
                            .delete()
                            .eq('id', id);
                        if (error) throw error;
                        return true;
                    } catch (error) {
                        console.error('Erro ao excluir artigo:', error);
                        throw error;
                    }
                },

                // Adicionar um novo evento
                addEvent: async function(event) {
                    try {
                        const eventData = {
                            title: event.title,
                            event_date: event.eventDate,
                            location: event.location,
                            category: event.category,
                            event_type: event.eventType,
                            description: event.description,
                            image_link: event.imageLink,
                            link: event.link,
                            created_at: new Date().toISOString()
                        };

                        const { data, error } = await window.supabaseClient
                            .from('events')
                            .insert([eventData])
                            .select();
                        if (error) throw error;
                        return data[0];
                    } catch (error) {
                        console.error('Erro ao adicionar evento:', error);
                        throw error;
                    }
                },

                // Atualizar um evento existente
                updateEvent: async function(id, event) {
                    try {
                        const eventData = {
                            title: event.title,
                            event_date: event.eventDate,
                            location: event.location,
                            category: event.category,
                            event_type: event.eventType,
                            description: event.description,
                            image_link: event.imageLink,
                            link: event.link,
                            updated_at: new Date().toISOString()
                        };

                        const { data, error } = await window.supabaseClient
                            .from('events')
                            .update(eventData)
                            .eq('id', id)
                            .select();
                        if (error) throw error;
                        return data[0];
                    } catch (error) {
                        console.error('Erro ao atualizar evento:', error);
                        throw error;
                    }
                },

                // Excluir um evento
                deleteEvent: async function(id) {
                    try {
                        const { error } = await window.supabaseClient
                            .from('events')
                            .delete()
                            .eq('id', id);
                        if (error) throw error;
                        return true;
                    } catch (error) {
                        console.error('Erro ao excluir evento:', error);
                        throw error;
                    }
                },

                // Adicionar um novo material
                addMaterial: async function(material) {
                    try {
                        const materialData = {
                            title: material.title,
                            type: material.type,
                            category: material.category,
                            access: material.access,
                            description: material.description,
                            file_link: material.fileLink,
                            cover_link: material.coverLink,
                            created_at: new Date().toISOString()
                        };

                        const { data, error } = await window.supabaseClient
                            .from('materials')
                            .insert([materialData])
                            .select();
                        if (error) throw error;
                        return data[0];
                    } catch (error) {
                        console.error('Erro ao adicionar material:', error);
                        throw error;
                    }
                },

                // Atualizar um material existente
                updateMaterial: async function(id, material) {
                    try {
                        const materialData = {
                            title: material.title,
                            type: material.type,
                            category: material.category,
                            access: material.access,
                            description: material.description,
                            file_link: material.fileLink,
                            cover_link: material.coverLink,
                            updated_at: new Date().toISOString()
                        };

                        const { data, error } = await window.supabaseClient
                            .from('materials')
                            .update(materialData)
                            .eq('id', id)
                            .select();
                        if (error) throw error;
                        return data[0];
                    } catch (error) {
                        console.error('Erro ao atualizar material:', error);
                        throw error;
                    }
                },

                // Excluir um material
                deleteMaterial: async function(id) {
                    try {
                        const { error } = await window.supabaseClient
                            .from('materials')
                            .delete()
                            .eq('id', id);
                        if (error) throw error;
                        return true;
                    } catch (error) {
                        console.error('Erro ao excluir material:', error);
                        throw error;
                    }
                },

                // Obter contagens de artigos, eventos e materiais
                getCounts: async function() {
                    try {
                        const [articlesRes, eventsRes, materialsRes] = await Promise.all([
                            window.supabaseClient.from('articles').select('id', { count: 'exact', head: true }),
                            window.supabaseClient.from('events').select('id', { count: 'exact', head: true }),
                            window.supabaseClient.from('materials').select('id', { count: 'exact', head: true })
                        ]);

                        return {
                            articles: articlesRes.count || 0,
                            events: eventsRes.count || 0,
                            materials: materialsRes.count || 0
                        };
                    } catch (error) {
                        console.error('Erro ao obter contagens:', error);
                        return { articles: 0, events: 0, materials: 0 };
                    }
                },

                // Função para verificar credenciais de administrador
                checkAdminCredentials: async function(username, password) {
                    try {
                        const { data, error } = await window.supabaseClient
                            .from('admins')
                            .select('*')
                            .eq('username', username)
                            .eq('password', password)
                            .single();
                        if (error) throw error;
                        return data;
                    } catch (error) {
                        console.error('Erro ao verificar credenciais:', error);
                        return null;
                    }
                }
            };

            // Alias para compatibilidade
            window.AdminData = window.BlogData;

            // Após a inicialização, chamar funções que dependem do BlogData
            updateDashboardCounts();
            refreshRecentArticlesList();
        }

        // Chamar a inicialização do Supabase quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof supabase === 'undefined') {
                console.error('Biblioteca Supabase não carregada');
                alert('Erro ao carregar as bibliotecas necessárias. Por favor, recarregue a página.');
                return;
            }
            
            try {
                initializeSupabase();
            } catch (error) {
                console.error('Erro ao inicializar o Supabase:', error);
                alert('Ocorreu um erro ao conectar com o banco de dados. Por favor, recarregue a página.');
            }
        });
    </script>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Container -->
            <div id="sidebar-container"></div>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Painel Administrativo</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <a href="../index.html" class="btn btn-sm btn-outline-secondary" target="_blank">Ver Blog</a>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div id="dashboard-content" class="content-section">
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Total de Artigos</h5>
                                    <h2 class="card-text">0</h2>
                                    <button class="btn btn-sm btn-primary show-section-btn" data-section="articles">Ver Artigos</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Eventos</h5>
                                    <h2 class="card-text">0</h2>
                                    <button class="btn btn-sm btn-primary show-section-btn" data-section="events">Ver Eventos</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Materiais</h5>
                                    <h2 class="card-text">0</h2>
                                    <button class="btn btn-sm btn-primary show-section-btn" data-section="resources">Ver Materiais</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de artigos recentes -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>Artigos Recentes</h5>
                        </div>
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Título</th>
                                        <th>Categoria</th>
                                        <th>Data</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-articles-list">
                                    <tr>
                                        <td colspan="4" class="text-center">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Articles Section -->
                <div id="articles-content" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Gerenciar Artigos</h3>
                        <button class="btn btn-primary" id="new-article-btn">Novo Artigo</button>
                    </div>
                    
                    <div id="articles-list-container">
                        <div class="alert alert-info">Carregando artigos...</div>
                    </div>
                </div>

                <!-- Events Section -->
                <div id="events-content" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h3>Gerenciar Eventos</h3>
                            <p class="text-muted">Gerencie todos os eventos do blog</p>
                        </div>
                        <button class="btn btn-success" id="new-event-btn">
                            <i class="bi bi-calendar-plus"></i> Novo Evento
                        </button>
                    </div>
                    
                    <!-- Filtros de eventos -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="event-filter-category" class="form-label">Categoria</label>
                                    <select id="event-filter-category" class="form-select">
                                        <option value="">Todas as categorias</option>
                                        <option value="medicina">Medicina</option>
                                        <option value="engenharia">Engenharias</option>
                                        <option value="petroleo-gas">Petróleo e Gás</option>
                                        <option value="ingles">Inglês</option>
                                        <option value="diversos">Diversos</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="event-filter-type" class="form-label">Tipo</label>
                                    <select id="event-filter-type" class="form-select">
                                        <option value="">Todos os tipos</option>
                                        <option value="congresso">Congresso</option>
                                        <option value="simposio">Simpósio</option>
                                        <option value="curso">Curso</option>
                                        <option value="webinar">Webinar</option>
                                        <option value="workshop">Workshop</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="event-filter-date" class="form-label">Data</label>
                                    <select id="event-filter-date" class="form-select">
                                        <option value="">Todas as datas</option>
                                        <option value="upcoming">Próximos eventos</option>
                                        <option value="past">Eventos passados</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button id="apply-event-filters" class="btn btn-sm btn-primary">
                                        Aplicar Filtros
                                    </button>
                                    <button id="clear-event-filters" class="btn btn-sm btn-outline-secondary">
                                        Limpar Filtros
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lista de eventos -->
                    <div id="events-list-container">
                        <div class="alert alert-info">Carregando eventos...</div>
                    </div>
                </div>

                <!-- Publications Section -->
                <div id="publications-content" class="content-section">
                    <div class="publications-header d-flex justify-content-between align-items-center">
                        <div>
                            <h3>Gerenciar Publicações</h3>
                            <p class="text-muted">Gerencie todos os tipos de conteúdo do blog em um só lugar</p>
                        </div>
                        <div class="publication-actions">
                            <button class="btn btn-primary" id="pub-article-btn">
                                <i class="bi bi-file-earmark-text"></i> Novo Artigo
                            </button>
                            <button class="btn btn-success" id="pub-event-btn">
                                <i class="bi bi-calendar-event"></i> Novo Evento
                            </button>
                            <button class="btn btn-info text-white" id="pub-material-btn">
                                <i class="bi bi-file-earmark-richtext"></i> Novo Material
                            </button>
                        </div>
                    </div>
                    
                    <!-- Conteúdo da página de publicações -->
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Artigos</h5>
                                </div>
                                <div class="card-body">
                                    <p>Total: <span id="pub-articles-count">0</span> artigos</p>
                                    <button class="btn btn-sm btn-primary show-section-btn" data-section="articles">
                                        Ver Todos
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Eventos</h5>
                                </div>
                                <div class="card-body">
                                    <p>Total: <span id="pub-events-count">0</span> eventos</p>
                                    <button class="btn btn-sm btn-primary show-section-btn" data-section="events">
                                        Ver Todos
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Materiais</h5>
                                </div>
                                <div class="card-body">
                                    <p>Total: <span id="pub-materials-count">0</span> materiais</p>
                                    <button class="btn btn-sm btn-primary show-section-btn" data-section="resources">
                                        Ver Todos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Content -->
                <div id="media-content" class="content-section">
                    <h3>Biblioteca de Mídia</h3>
                    <p class="text-muted">Gerencie todos os arquivos de mídia do blog</p>
                    <div class="alert alert-info">
                        Funcionalidade em desenvolvimento. Em breve você poderá gerenciar imagens e outros arquivos de mídia aqui.
                    </div>
                </div>
                
                <!-- Categories Content -->
                <div id="categories-content" class="content-section">
                    <h3>Categorias</h3>
                    <p class="text-muted">Gerencie as categorias do blog</p>
                    <div class="alert alert-info">
                        Funcionalidade em desenvolvimento. Em breve você poderá gerenciar categorias aqui.
                    </div>
                </div>
                
                <!-- Resources/Materials Section -->
                <div id="resources-content" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h3>Gerenciar Materiais</h3>
                            <p class="text-muted">Gerencie todos os materiais disponíveis para download</p>
                        </div>
                        <button class="btn btn-info text-white" id="new-material-btn">
                            <i class="bi bi-file-earmark-plus"></i> Novo Material
                        </button>
                    </div>
                    
                    <!-- Filtros de materiais -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="material-filter-category" class="form-label">Categoria</label>
                                    <select id="material-filter-category" class="form-select">
                                        <option value="">Todas as categorias</option>
                                        <option value="medicina">Medicina</option>
                                        <option value="engenharia">Engenharias</option>
                                        <option value="petroleo-gas">Petróleo e Gás</option>
                                        <option value="ingles">Inglês</option>
                                        <option value="diversos">Diversos</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="material-filter-type" class="form-label">Tipo</label>
                                    <select id="material-filter-type" class="form-select">
                                        <option value="">Todos os tipos</option>
                                        <option value="manual">Manual</option>
                                        <option value="guia">Guia</option>
                                        <option value="ebook">E-book</option>
                                        <option value="software">Software</option>
                                        <option value="infografico">Infográfico</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="material-filter-access" class="form-label">Acesso</label>
                                    <select id="material-filter-access" class="form-select">
                                        <option value="">Todos</option>
                                        <option value="gratuito">Gratuito</option>
                                        <option value="pago">Pago</option>
                                        <option value="restrito">Restrito</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button id="apply-material-filters" class="btn btn-sm btn-primary">
                                        Aplicar Filtros
                                    </button>
                                    <button id="clear-material-filters" class="btn btn-sm btn-outline-secondary">
                                        Limpar Filtros
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lista de materiais -->
                    <div id="materials-list-container">
                        <div class="alert alert-info">Carregando materiais...</div>
                    </div>
                </div>
                
                <!-- Settings Content -->
                <div id="settings-content" class="content-section">
                    <h3>Configurações</h3>
                    <p class="text-muted">Configure as preferências do blog</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Informações do Usuário</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p><strong>Usuário:</strong> Admin</p>
                                        <p><strong>Último acesso:</strong> <span id="last-login-date">Hoje</span></p>
                                    </div>
                                    <button class="btn btn-danger" id="logout-btn">
                                        <i class="bi bi-box-arrow-right"></i> Sair do Sistema
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Preferências</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Tema</label>
                                        <div class="d-flex">
                                            <div class="form-check me-3">
                                                <input class="form-check-input" type="radio" name="theme" id="theme-light" value="light"
                                                checked>
                                                <label class="form-check-label" for="theme-light">
                                                    Claro
                                                </label>
                                            </div>
                                            <div class="form-check me-3">
                                                <input class="form-check-input" type="radio" name="theme" id="theme-dark" value="dark">
                                                <label class="form-check-label" for="theme-dark">
                                                    Escuro
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" id="save-preferences-btn">
                                        <i class="bi bi-save"></i> Salvar Preferências
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal para Artigos Científicos -->
    <div id="uploadArticleModal" class="modal fade" tabindex="-1" aria-labelledby="uploadArticleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadArticleModalLabel">Novo Artigo Científico</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="scientific-article-form">
                        <!-- Informações básicas -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="article-title" class="form-label">Título do Artigo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="article-title" required>
                            </div>
                            <div class="col-md-4">
                                <label for="article-date" class="form-label">Data de Publicação <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="article-date" required>
                            </div>
                        </div>
                        
                        <!-- Autores e categorização -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="article-authors" class="form-label">Autores <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="article-authors" placeholder="Ex: Silva, J., Oliveira, M. & Santos, P." required>
                            </div>
                            <div class="col-md-3">
                                <label for="article-category" class="form-label">Categoria <span class="text-danger">*</span></label>
                                <select class="form-select" id="article-category" required>
                                    <option value="">Selecione</option>
                                    <option value="medicina">Medicina</option>
                                    <option value="engenharia">Engenharias</option>
                                    <option value="petroleo-gas">Petróleo e Gás</option>
                                    <option value="ingles">Inglês</option>
                                    <option value="diversos">Diversos</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="article-subcategory" class="form-label">Subcategoria</label>
                                <select class="form-select" id="article-subcategory">
                                    <option value="">Selecione</option>
                                </select>
                            </div>
                        </div>

                        <!-- Journal e DOI -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="article-journal" class="form-label">Revista/Journal</label>
                                <input type="text" class="form-control" id="article-journal" placeholder="Ex: Revista Brasileira de Medicina">
                            </div>
                            <div class="col-md-6">
                                <label for="article-doi" class="form-label">DOI (se disponível)</label>
                                <input type="text" class="form-control" id="article-doi" placeholder="Ex: 10.1000/xyz123">
                            </div>
                        </div>
                        
                        <!-- Resumo -->
                        <div class="mb-3">
                            <label for="article-abstract" class="form-label">Resumo/Abstract <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="article-abstract" rows="4" maxlength="500" required></textarea>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">Resumo breve do artigo, será exibido na listagem de publicações</small>
                                <small id="abstract-counter" class="text-muted">0/500</small>
                            </div>
                        </div>
                        
                        <!-- Links de arquivo e imagem -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="article-file-link" class="form-label">Link do Artigo (PDF) <span class="text-danger">*</span></label>
                                <input type="url" class="form-control" id="article-file-link" placeholder="https://drive.google.com/file/d/..." required>
                                <small class="text-muted">Cole o link compartilhável do Google Drive, Dropbox, etc.</small>
                            </div>
                            <div class="col-md-6">
                                <label for="article-thumbnail-link" class="form-label">Link da Imagem em Destaque</label>
                                <input type="url" class="form-control" id="article-thumbnail-link" placeholder="https://i.imgur.com/...">
                                <small class="text-muted">Cole o link direto da imagem (JPG, PNG, etc.)</small>
                            </div>
                        </div>
                        
                        <!-- Conteúdo -->
                        <div class="mb-3">
                            <label for="article-content" class="form-label">Conteúdo Adicional / Detalhes</label>
                            <textarea class="form-control" id="article-content" rows="4"></textarea>
                            <small class="text-muted">Conteúdo que será exibido na página de detalhes do artigo (opcional)</small>
                        </div>
                        
                        <!-- Status, idioma e acesso -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="article-status" class="form-label">Status</label>
                                <select class="form-select" id="article-status">
                                    <option value="publicado">Publicado</option>
                                    <option value="rascunho">Rascunho</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="article-language" class="form-label">Idioma Principal</label>
                                <select class="form-select" id="article-language">
                                    <option value="pt">Português</option>
                                    <option value="en">Inglês</option>
                                    <option value="es">Espanhol</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="article-access" class="form-label">Acesso</label>
                                <select class="form-select" id="article-access">
                                    <option value="publico">Público</option>
                                    <option value="restrito">Restrito</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Tags -->
                        <div class="mb-3">
                            <label for="article-tags" class="form-label">Tags</label>
                            <input type="text" class="form-control" id="article-tags" placeholder="Separe as tags por vírgulas">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="save-article-btn">
                        <span id="save-article-btn-text">Salvar Artigo</span>
                        <span id="save-article-btn-loading" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Eventos -->
    <div id="uploadEventModal" class="modal fade" tabindex="-1" aria-labelledby="uploadEventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadEventModalLabel">Novo Evento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="event-form">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="event-title" class="form-label required">Título do Evento</label>
                                <input type="text" class="form-control" id="event-title" required>
                            </div>
                            <div class="col-md-4">
                                <label for="event-date" class="form-label required">Data do Evento</label>
                                <input type="date" class="form-control" id="event-date" required>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="event-location" class="form-label required">Local</label>
                                <input type="text" class="form-control" id="event-location" required>
                            </div>
                            <div class="col-md-3">
                                <label for="event-category" class="form-label required">Categoria</label>
                                <select class="form-select" id="event-category" required>
                                    <option value="">Selecione</option>
                                    <option value="medicina">Medicina</option>
                                    <option value="engenharia">Engenharias</option>
                                    <option value="petroleo-gas">Petróleo e Gás</option>
                                    <option value="ingles">Inglês</option>
                                    <option value="diversos">Diversos</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="event-type" class="form-label">Tipo</label>
                                <select class="form-select" id="event-type">
                                    <option value="congresso">Congresso</option>
                                    <option value="simposio">Simpósio</option>
                                    <option value="curso">Curso</option>
                                    <option value="webinar">Webinar</option>
                                    <option value="workshop">Workshop</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="event-description" class="form-label">Descrição</label>
                            <textarea class="form-control" id="event-description" rows="4"></textarea>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="event-image-link" class="form-label">Link da Imagem do Evento</label>
                                <input type="url" class="form-control" id="event-image-link" placeholder="https://i.imgur.com/...">
                                <small class="text-muted">Cole o link direto da imagem (JPG, PNG, etc.)</small>
                            </div>
                            <div class="col-md-6">
                                <label for="event-link" class="form-label">Link para Inscrição</label>
                                <input type="url" class="form-control" id="event-link" placeholder="https://...">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="save-event-btn">
                        <span id="save-event-btn-text">Salvar Evento</span>
                        <span id="save-event-btn-loading" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Materiais -->
    <div id="uploadMaterialModal" class="modal fade" tabindex="-1" aria-labelledby="uploadMaterialModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadMaterialModalLabel">Novo Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="material-form">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="material-title" class="form-label required">Título do Material</label>
                                <input type="text" class="form-control" id="material-title" required>
                            </div>
                            <div class="col-md-4">
                                <label for="material-type" class="form-label required">Tipo</label>
                                <select class="form-select" id="material-type" required>
                                    <option value="">Selecione</option>
                                    <option value="manual">Manual</option>
                                    <option value="guia">Guia</option>
                                    <option value="ebook">E-book</option>
                                    <option value="software">Software</option>
                                    <option value="infografico">Infográfico</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="material-category" class="form-label required">Categoria</label>
                                <select class="form-select" id="material-category" required>
                                    <option value="">Selecione</option>
                                    <option value="medicina">Medicina</option>
                                    <option value="engenharia">Engenharias</option>
                                    <option value="petroleo-gas">Petróleo e Gás</option>
                                    <option value="ingles">Inglês</option>
                                    <option value="diversos">Diversos</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="material-access" class="form-label">Acesso</label>
                                <select class="form-select" id="material-access">
                                    <option value="gratuito">Gratuito</option>
                                    <option value="pago">Pago</option>
                                    <option value="restrito">Restrito</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="material-description" class="form-label">Descrição</label>
                            <textarea class="form-control" id="material-description" rows="3"></textarea>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="material-file-link" class="form-label required">Link do Arquivo</label>
                                <input type="url" class="form-control" id="material-file-link" placeholder="https://drive.google.com/file/d/..." required>
                                <small class="text-muted">Cole o link compartilhável do Google Drive, Dropbox, etc.</small>
                            </div>
                            <div class="col-md-6">
                                <label for="material-cover-link" class="form-label">Link da Imagem de Capa</label>
                                <input type="url" class="form-control" id="material-cover-link" placeholder="https://i.imgur.com/...">
                                <small class="text-muted">Cole o link direto da imagem (JPG, PNG, etc.)</small>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-info text-white" id="save-material-btn">
                        <span id="save-material-btn-text">Salvar Material</span>
                        <span id="save-material-btn-loading" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Função para verificar autenticação
        function checkAuthentication() {
            if (!localStorage.getItem('adminLoggedIn')) {
                window.location.href = 'login.html';
                return false;
            }
            
            const expirationTime = localStorage.getItem('adminLoginExpires');
            if (expirationTime && Date.now() > parseInt(expirationTime)) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginExpires');
                localStorage.removeItem('adminRemembered');
                window.location.href = 'login.html';
                return false;
            }
            
            return true;
        }
        
        // Função de logout
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminLoginExpires');
            localStorage.removeItem('adminRemembered');
            localStorage.setItem('logoutMessage', 'Logout realizado com sucesso!');
            window.location.href = 'login.html';
        }

        // Função para exibir mensagem de erro
        function showErrorAlert(message) {
            const errorAlert = document.createElement('div');
            errorAlert.className = 'alert alert-danger alert-dismissible fade show fixed-bottom mx-4 mb-4';
            errorAlert.innerHTML = `
                <strong>Erro!</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            document.body.appendChild(errorAlert);
            
            setTimeout(() => {
                errorAlert.remove();
            }, 5000);
        }

        // Função para exibir mensagem de sucesso
        function showSuccessAlert(message) {
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show fixed-bottom mx-4 mb-4';
            successAlert.innerHTML = `
                <strong>Sucesso!</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            document.body.appendChild(successAlert);
            
            setTimeout(() => {
                successAlert.remove();
            }, 5000);
        }

        // Função para formatar datas
        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('pt-BR');
            } catch (error) {
                return dateStr;
            }
        }

        // Função para mostrar seções
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            const targetSection = document.getElementById(sectionId + '-content');
            if (targetSection) {
                targetSection.style.display = 'block';
                
                if (sectionId === 'articles') {
                    loadArticles();
                } else if (sectionId === 'resources') {
                    loadMaterials();
                } else if (sectionId === 'events') {
                    loadEvents();
                }
            }
        }

        // Função para carregar artigos
        async function loadArticles() {
            const container = document.getElementById('articles-list-container');
            if (!container) return;
            
            container.innerHTML = '<div class="alert alert-info">Carregando artigos...</div>';
            
            try {
                const articles = await window.BlogData.fetchArticles();
                
                if (!articles || articles.length === 0) {
                    container.innerHTML = '<div class="alert alert-info">Nenhum artigo encontrado. Clique em "Novo Artigo" para adicionar um.</div>';
                    return;
                }
                
                const table = document.createElement('div');
                table.className = 'table-responsive';
                table.innerHTML = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Categoria</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="articles-list"></tbody>
                    </table>
                `;
                container.innerHTML = '';
                container.appendChild(table);
                
                const tbody = document.getElementById('articles-list');
                articles.forEach(article => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${article.title}</td>
                        <td>${article.category}${article.subcategory ? ' / ' + article.subcategory : ''}</td>
                        <td>${formatDate(article.date)}</td>
                        <td><span class="badge ${article.status === 'publicado' ? 'bg-success' : 'bg-warning'}">${article.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary me-1 edit-article-btn" data-id="${article.id}">Editar</button>
                            <a href="${article.file_link}" target="_blank" class="btn btn-sm btn-info text-white me-1">Ver</a>
                            <button class="btn btn-sm btn-danger delete-article-btn" data-id="${article.id}">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Adicionar eventos aos botões de edição e exclusão
                document.querySelectorAll('.edit-article-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const articleId = this.getAttribute('data-id');
                        editArticle(articleId);
                    });
                });

                document.querySelectorAll('.delete-article-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const articleId = this.getAttribute('data-id');
                        if (confirm('Tem certeza que deseja excluir este artigo?')) {
                            try {
                                await window.BlogData.deleteArticle(articleId);
                                loadArticles();
                                refreshRecentArticlesList();
                                updateDashboardCounts();
                                showSuccessAlert('Artigo excluído com sucesso.');
                            } catch (error) {
                                showErrorAlert('Erro ao excluir artigo: ' + (error.message || 'Tente novamente.'));
                            }
                        }
                    });
                });
            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erro ao carregar artigos: ' + (error.message || 'Tente novamente.') + '</div>';
            }
        }

        // Função para editar artigo
        async function editArticle(articleId) {
            try {
                const articles = await window.BlogData.fetchArticles();
                const article = articles.find(a => a.id === articleId);
                if (!article) {
                    showErrorAlert('Artigo não encontrado.');
                    return;
                }

                // Preencher o formulário com os dados do artigo
                document.getElementById('article-title').value = article.title;
                document.getElementById('article-date').value = article.date;
                document.getElementById('article-authors').value = article.authors;
                document.getElementById('article-category').value = article.category;

                // Disparar o evento change para carregar subcategorias
                const categoryEvent = new Event('change');
                document.getElementById('article-category').dispatchEvent(categoryEvent);

                document.getElementById('article-subcategory').value = article.subcategory || '';
                document.getElementById('article-journal').value = article.journal || '';
                document.getElementById('article-doi').value = article.doi || '';
                document.getElementById('article-abstract').value = article.abstract;
                document.getElementById('article-file-link').value = article.file_link;
                document.getElementById('article-thumbnail-link').value = article.thumbnail_link || '';
                document.getElementById('article-content').value = article.content || '';
                document.getElementById('article-status').value = article.status || 'publicado';
                document.getElementById('article-language').value = article.language || 'pt';
                document.getElementById('article-access').value = article.access || 'publico';
                document.getElementById('article-tags').value = article.tags || '';

                // Atualizar o contador de caracteres do resumo
                const abstractEvent = new Event('input');
                document.getElementById('article-abstract').dispatchEvent(abstractEvent);

                // Definir o ID do artigo no formulário para edição
                document.getElementById('scientific-article-form').dataset.articleId = articleId;
                document.getElementById('uploadArticleModalLabel').textContent = 'Editar Artigo';

                // Abrir o modal
                const modal = new bootstrap.Modal(document.getElementById('uploadArticleModal'));
                modal.show();
            } catch (error) {
                showErrorAlert('Erro ao carregar artigo para edição: ' + (error.message || 'Tente novamente.'));
            }
        }

        // Função para carregar eventos
        async function loadEvents() {
            const container = document.getElementById('events-list-container');
            if (!container) return;

            container.innerHTML = '<div class="alert alert-info">Carregando eventos...</div>';

            try {
                const events = await window.BlogData.fetchEvents();

                if (!events || events.length === 0) {
                    container.innerHTML = '<div class="alert alert-info">Nenhum evento encontrado. Clique em "Novo Evento" para adicionar um.</div>';
                    return;
                }

                const table = document.createElement('div');
                table.className = 'table-responsive';
                table.innerHTML = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Categoria</th>
                                <th>Data</th>
                                <th>Local</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="events-list"></tbody>
                    </table>
                `;
                container.innerHTML = '';
                container.appendChild(table);

                const tbody = document.getElementById('events-list');
                events.forEach(event => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${event.title}</td>
                        <td>${event.category}</td>
                        <td>${formatDate(event.event_date)}</td>
                        <td>${event.location}</td>
                        <td>
                            <button class="btn btn-sm btn-primary me-1 edit-event-btn" data-id="${event.id}">Editar</button>
                            <a href="${event.link || '#'}" target="_blank" class="btn btn-sm btn-info text-white me-1 ${!event.link ? 'disabled' : ''}">Ver</a>
                            <button class="btn btn-sm btn-danger delete-event-btn" data-id="${event.id}">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Adicionar eventos aos botões de edição e exclusão
                document.querySelectorAll('.edit-event-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-id');
                        editEvent(eventId);
                    });
                });

                document.querySelectorAll('.delete-event-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const eventId = this.getAttribute('data-id');
                        if (confirm('Tem certeza que deseja excluir este evento?')) {
                            try {
                                await window.BlogData.deleteEvent(eventId);
                                loadEvents();
                                updateDashboardCounts();
                                showSuccessAlert('Evento excluído com sucesso.');
                            } catch (error) {
                                showErrorAlert('Erro ao excluir evento: ' + (error.message || 'Tente novamente.'));
                            }
                        }
                    });
                });
            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erro ao carregar eventos: ' + (error.message || 'Tente novamente.') + '</div>';
            }
        }

        // Função para editar evento
        async function editEvent(eventId) {
            try {const events = await window.BlogData.fetchEvents();
                const event = events.find(e => e.id === eventId);
                if (!event) {
                    showErrorAlert('Evento não encontrado.');
                    return;
                }

                // Preencher o formulário com os dados do evento
                document.getElementById('event-title').value = event.title;
                document.getElementById('event-date').value = event.event_date;
                document.getElementById('event-location').value = event.location;
                document.getElementById('event-category').value = event.category;
                document.getElementById('event-type').value = event.event_type || 'congresso';
                document.getElementById('event-description').value = event.description || '';
                document.getElementById('event-image-link').value = event.image_link || '';
                document.getElementById('event-link').value = event.link || '';

                // Definir o ID do evento no formulário para edição
                document.getElementById('event-form').dataset.eventId = eventId;
                document.getElementById('uploadEventModalLabel').textContent = 'Editar Evento';

                // Abrir o modal
                const modal = new bootstrap.Modal(document.getElementById('uploadEventModal'));
                modal.show();
            } catch (error) {
                showErrorAlert('Erro ao carregar evento para edição: ' + (error.message || 'Tente novamente.'));
            }
        }

        // Função para carregar materiais
        async function loadMaterials() {
            const container = document.getElementById('materials-list-container');
            if (!container) return;

            container.innerHTML = '<div class="alert alert-info">Carregando materiais...</div>';

            try {
                const materials = await window.BlogData.fetchMaterials();

                if (!materials || materials.length === 0) {
                    container.innerHTML = '<div class="alert alert-info">Nenhum material encontrado. Clique em "Novo Material" para adicionar um.</div>';
                    return;
                }

                const table = document.createElement('div');
                table.className = 'table-responsive';
                table.innerHTML = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Tipo</th>
                                <th>Categoria</th>
                                <th>Acesso</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="materials-list"></tbody>
                    </table>
                `;
                container.innerHTML = '';
                container.appendChild(table);

                const tbody = document.getElementById('materials-list');
                materials.forEach(material => {
                    const tr = document.createElement('tr');
                    const accessBadgeClass = material.access === 'gratuito' ? 'bg-success' : material.access === 'pago' ? 'bg-warning text-dark' : 'bg-danger';
                    tr.innerHTML = `
                        <td>${material.title}</td>
                        <td>${material.type}</td>
                        <td>${material.category}</td>
                        <td><span class="badge ${accessBadgeClass}">${material.access}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary me-1 edit-material-btn" data-id="${material.id}">Editar</button>
                            <a href="${material.file_link}" target="_blank" class="btn btn-sm btn-info text-white me-1">Ver</a>
                            <button class="btn btn-sm btn-danger delete-material-btn" data-id="${material.id}">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Adicionar eventos aos botões de edição e exclusão
                document.querySelectorAll('.edit-material-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const materialId = this.getAttribute('data-id');
                        editMaterial(materialId);
                    });
                });

                document.querySelectorAll('.delete-material-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const materialId = this.getAttribute('data-id');
                        if (confirm('Tem certeza que deseja excluir este material?')) {
                            try {
                                await window.BlogData.deleteMaterial(materialId);
                                loadMaterials();
                                updateDashboardCounts();
                                showSuccessAlert('Material excluído com sucesso.');
                            } catch (error) {
                                showErrorAlert('Erro ao excluir material: ' + (error.message || 'Tente novamente.'));
                            }
                        }
                    });
                });
            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erro ao carregar materiais: ' + (error.message || 'Tente novamente.') + '</div>';
            }
        }

        // Função para editar material
        async function editMaterial(materialId) {
            try {
                const materials = await window.BlogData.fetchMaterials();
                const material = materials.find(m => m.id === materialId);
                if (!material) {
                    showErrorAlert('Material não encontrado.');
                    return;
                }

                // Preencher o formulário com os dados do material
                document.getElementById('material-title').value = material.title;
                document.getElementById('material-type').value = material.type;
                document.getElementById('material-category').value = material.category;
                document.getElementById('material-access').value = material.access || 'gratuito';
                document.getElementById('material-description').value = material.description || '';
                document.getElementById('material-file-link').value = material.file_link;
                document.getElementById('material-cover-link').value = material.cover_link || '';

                // Definir o ID do material no formulário para edição
                document.getElementById('material-form').dataset.materialId = materialId;
                document.getElementById('uploadMaterialModalLabel').textContent = 'Editar Material';

                // Abrir o modal
                const modal = new bootstrap.Modal(document.getElementById('uploadMaterialModal'));
                modal.show();
            } catch (error) {
                showErrorAlert('Erro ao carregar material para edição: ' + (error.message || 'Tente novamente.'));
            }
        }

        // Função para atualizar contadores no dashboard
        async function updateDashboardCounts() {
            try {
                const counts = await window.BlogData.getCounts();

                document.querySelector('#dashboard-content .card:nth-child(1) .card-text').textContent = counts.articles;
                document.querySelector('#dashboard-content .card:nth-child(2) .card-text').textContent = counts.events;
                document.querySelector('#dashboard-content .card:nth-child(3) .card-text').textContent = counts.materials;

                document.getElementById('pub-articles-count').textContent = counts.articles;
                document.getElementById('pub-events-count').textContent = counts.events;
                document.getElementById('pub-materials-count').textContent = counts.materials;
            } catch (error) {
                console.error('Erro ao atualizar contadores:', error);
            }
        }

        // Função para atualizar a lista de artigos recentes
        async function refreshRecentArticlesList() {
            const container = document.getElementById('recent-articles-list');
            if (!container) return;

            container.innerHTML = '<tr><td colspan="4" class="text-center">Carregando...</td></tr>';

            try {
                const articles = await window.BlogData.fetchArticles();
                container.innerHTML = '';

                if (!articles || articles.length === 0) {
                    container.innerHTML = '<tr><td colspan="4" class="text-center">Nenhum artigo encontrado.</td></tr>';
                    return;
                }

                const recentArticles = articles.slice(0, 3);
                recentArticles.forEach(article => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${article.title}</td>
                        <td>${article.category}</td>
                        <td>${formatDate(article.date)}</td>
                        <td>
                            <a href="${article.file_link}" target="_blank" class="btn btn-sm btn-info text-white me-1">Ver</a>
                            <button class="btn btn-sm btn-danger delete-article-btn" data-id="${article.id}">Excluir</button>
                        </td>
                    `;
                    container.appendChild(tr);
                });

                // Adicionar eventos aos botões de exclusão
                document.querySelectorAll('.delete-article-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const articleId = this.getAttribute('data-id');
                        if (confirm('Tem certeza que deseja excluir este artigo?')) {
                            try {
                                await window.BlogData.deleteArticle(articleId);
                                refreshRecentArticlesList();
                                updateDashboardCounts();
                                loadArticles();
                                showSuccessAlert('Artigo excluído com sucesso.');
                            } catch (error) {
                                showErrorAlert('Erro ao excluir artigo: ' + (error.message || 'Tente novamente.'));
                            }
                        }
                    });
                });
            } catch (error) {
                container.innerHTML = '<tr><td colspan="4" class="text-center">Erro ao carregar artigos: ' + (error.message || 'Tente novamente.') + '</td></tr>';
            }
        }

        // Função para filtrar eventos
        async function filterEvents() {
            const category = document.getElementById('event-filter-category').value;
            const type = document.getElementById('event-filter-type').value;
            const dateFilter = document.getElementById('event-filter-date').value;

            const container = document.getElementById('events-list-container');
            container.innerHTML = '<div class="alert alert-info">Carregando eventos...</div>';

            try {
                let query = window.supabaseClient
                    .from('events')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (category) {
                    query = query.eq('category', category);
                }
                if (type) {
                    query = query.eq('event_type', type);
                }
                if (dateFilter) {
                    const today = new Date().toISOString().split('T')[0];
                    if (dateFilter === 'upcoming') {
                        query = query.gte('event_date', today);
                    } else if (dateFilter === 'past') {
                        query = query.lt('event_date', today);
                    }
                }

                const { data: events, error } = await query;
                if (error) throw error;

                if (!events || events.length === 0) {
                    container.innerHTML = '<div class="alert alert-info">Nenhum evento encontrado com os filtros aplicados.</div>';
                    return;
                }

                const table = document.createElement('div');
                table.className = 'table-responsive';
                table.innerHTML = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Categoria</th>
                                <th>Data</th>
                                <th>Local</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="events-list"></tbody>
                    </table>
                `;
                container.innerHTML = '';
                container.appendChild(table);

                const tbody = document.getElementById('events-list');
                events.forEach(event => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${event.title}</td>
                        <td>${event.category}</td>
                        <td>${formatDate(event.event_date)}</td>
                        <td>${event.location}</td>
                        <td>
                            <button class="btn btn-sm btn-primary me-1 edit-event-btn" data-id="${event.id}">Editar</button>
                            <a href="${event.link || '#'}" target="_blank" class="btn btn-sm btn-info text-white me-1 ${!event.link ? 'disabled' : ''}">Ver</a>
                            <button class="btn btn-sm btn-danger delete-event-btn" data-id="${event.id}">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Adicionar eventos aos botões de edição e exclusão
                document.querySelectorAll('.edit-event-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-id');
                        editEvent(eventId);
                    });
                });

                document.querySelectorAll('.delete-event-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const eventId = this.getAttribute('data-id');
                        if (confirm('Tem certeza que deseja excluir este evento?')) {
                            try {
                                await window.BlogData.deleteEvent(eventId);
                                filterEvents();
                                updateDashboardCounts();
                                showSuccessAlert('Evento excluído com sucesso.');
                            } catch (error) {
                                showErrorAlert('Erro ao excluir evento: ' + (error.message || 'Tente novamente.'));
                            }
                        }
                    });
                });
            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erro ao filtrar eventos: ' + (error.message || 'Tente novamente.') + '</div>';
            }
        }

        // Função para filtrar materiais
        async function filterMaterials() {
            const category = document.getElementById('material-filter-category').value;
            const type = document.getElementById('material-filter-type').value;
            const access = document.getElementById('material-filter-access').value;

            const container = document.getElementById('materials-list-container');
            container.innerHTML = '<div class="alert alert-info">Carregando materiais...</div>';

            try {
                let query = window.supabaseClient
                    .from('materials')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (category) {
                    query = query.eq('category', category);
                }
                if (type) {
                    query = query.eq('type', type);
                }
                if (access) {
                    query = query.eq('access', access);
                }

                const { data: materials, error } = await query;
                if (error) throw error;

                if (!materials || materials.length === 0) {
                    container.innerHTML = '<div class="alert alert-info">Nenhum material encontrado com os filtros aplicados.</div>';
                    return;
                }

                const table = document.createElement('div');
                table.className = 'table-responsive';
                table.innerHTML = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Tipo</th>
                                <th>Categoria</th>
                                <th>Acesso</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="materials-list"></tbody>
                    </table>
                `;
                container.innerHTML = '';
                container.appendChild(table);

                const tbody = document.getElementById('materials-list');
                materials.forEach(material => {
                    const tr = document.createElement('tr');
                    const accessBadgeClass = material.access === 'gratuito' ? 'bg-success' : material.access === 'pago' ? 'bg-warning text-dark' : 'bg-danger';
                    tr.innerHTML = `
                        <td>${material.title}</td>
                        <td>${material.type}</td>
                        <td>${material.category}</td>
                        <td><span class="badge ${accessBadgeClass}">${material.access}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary me-1 edit-material-btn" data-id="${material.id}">Editar</button>
                            <a href="${material.file_link}" target="_blank" class="btn btn-sm btn-info text-white me-1">Ver</a>
                            <button class="btn btn-sm btn-danger delete-material-btn" data-id="${material.id}">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Adicionar eventos aos botões de edição e exclusão
                document.querySelectorAll('.edit-material-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const materialId = this.getAttribute('data-id');
                        editMaterial(materialId);
                    });
                });

                document.querySelectorAll('.delete-material-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const materialId = this.getAttribute('data-id');
                        if (confirm('Tem certeza que deseja excluir este material?')) {
                            try {
                                await window.BlogData.deleteMaterial(materialId);
                                filterMaterials();
                                updateDashboardCounts();
                                showSuccessAlert('Material excluído com sucesso.');
                            } catch (error) {
                                showErrorAlert('Erro ao excluir material: ' + (error.message || 'Tente novamente.'));
                            }
                        }
                    });
                });
            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erro ao filtrar materiais: ' + (error.message || 'Tente novamente.') + '</div>';
            }
        }

        // Verificar autenticação e configurar interface
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autenticação
            if (!checkAuthentication()) return;

            // Configurar a sidebar
            const sidebarContainer = document.getElementById('sidebar-container');
            if (sidebarContainer) {
                sidebarContainer.innerHTML = `
                    <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                        <div class="position-sticky pt-3">
                            <div class="sidebar-header mb-4">
                                <h5>Blog Multilingue</h5>
                                <p class="text-muted small">Painel Administrativo</p>
                            </div>
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#" data-section="dashboard">
                                        <i class="bi bi-house-door"></i> Dashboard
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="articles">
                                        <i class="bi bi-file-text"></i> Artigos
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="events">
                                        <i class="bi bi-calendar-event"></i> Eventos
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="resources">
                                        <i class="bi bi-download"></i> Materiais
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="media">
                                        <i class="bi bi-images"></i> Mídia
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="categories">
                                        <i class="bi bi-tag"></i> Categorias
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="publications">
                                        <i class="bi bi-journal-richtext"></i> Publicações
                                    </a>
                                </li>
                            </ul>
                            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                                <span>CONFIGURAÇÕES</span>
                            </h6>
                            <ul class="nav flex-column mb-2">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-section="settings">
                                        <i class="bi bi-gear"></i> Configurações
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                `;

                // Adicionar eventos de clique para os links da sidebar
                document.querySelectorAll('#sidebar .nav-link').forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const section = this.getAttribute('data-section');
                        showSection(section);

                        // Atualizar a classe active
                        document.querySelectorAll('#sidebar .nav-link').forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            }

            // Mostrar a seção inicial (dashboard)
            showSection('dashboard');

            // Configurar eventos para os botões de seção
            document.querySelectorAll('.show-section-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showSection(section);

                    // Atualizar a classe active na sidebar
                    document.querySelectorAll('#sidebar .nav-link').forEach(l => l.classList.remove('active'));
                    const sidebarLink = document.querySelector(`#sidebar .nav-link[data-section="${section}"]`);
                    if (sidebarLink) {
                        sidebarLink.classList.add('active');
                    }
                });
            });

            // Configurar o botão de logout
            document.getElementById('logout-btn').addEventListener('click', logout);

            // Configurar o tema
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.getElementById('theme-style').setAttribute('href', `../css/themes/${savedTheme}.css`);
            document.getElementById(`theme-${savedTheme}`).checked = true;

            document.getElementById('save-preferences-btn').addEventListener('click', function() {
                const selectedTheme = document.querySelector('input[name="theme"]:checked').value;
                localStorage.setItem('theme', selectedTheme);
                document.getElementById('theme-style').setAttribute('href', `../css/themes/${selectedTheme}.css`);
                showSuccessAlert('Preferências salvas com sucesso!');
            });

            // Configurar o contador de caracteres do resumo
            const abstractInput = document.getElementById('article-abstract');
            const abstractCounter = document.getElementById('abstract-counter');
            abstractInput.addEventListener('input', function() {
                const length = this.value.length;
                abstractCounter.textContent = `${length}/500`;
                if (length > 500) {
                    abstractCounter.classList.add('text-danger');
                } else {
                    abstractCounter.classList.remove('text-danger');
                }
            });

            // Configurar subcategorias dinâmicas
            const subcategories = {
                'medicina': ['Cardiologia', 'Neurologia', 'Oncologia'],
                'engenharia': ['Civil', 'Mecânica', 'Elétrica'],
                'petroleo-gas': ['Exploração', 'Produção', 'Refino'],
                'ingles': ['Gramática', 'Vocabulário', 'Conversação'],
                'diversos': ['Tecnologia', 'Educação', 'Cultura']
            };

            const categorySelect = document.getElementById('article-category');
            const subcategorySelect = document.getElementById('article-subcategory');
            categorySelect.addEventListener('change', function() {
                const category = this.value;
                subcategorySelect.innerHTML = '<option value="">Selecione</option>';
                if (category && subcategories[category]) {
                    subcategories[category].forEach(sub => {
                        const option = document.createElement('option');
                        option.value = sub;
                        option.textContent = sub;
                        subcategorySelect.appendChild(option);
                    });
                }
            });

            // Configurar o botão de novo artigo
            document.getElementById('new-article-btn').addEventListener('click', function() {
                document.getElementById('scientific-article-form').reset();
                document.getElementById('scientific-article-form').dataset.articleId = '';
                document.getElementById('uploadArticleModalLabel').textContent = 'Novo Artigo Científico';
                const modal = new bootstrap.Modal(document.getElementById('uploadArticleModal'));
                modal.show();
            });

            // Configurar o botão de salvar artigo
            document.getElementById('save-article-btn').addEventListener('click', async function() {
                const form = document.getElementById('scientific-article-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const saveBtnText = document.getElementById('save-article-btn-text');
                const saveBtnLoading = document.getElementById('save-article-btn-loading');
                saveBtnText.classList.add('d-none');
                saveBtnLoading.classList.remove('d-none');
                this.disabled = true;

                try {
                    const article = {
                        title: document.getElementById('article-title').value,
                        date: document.getElementById('article-date').value,
                        authors: document.getElementById('article-authors').value,
                        category: document.getElementById('article-category').value,
                        subcategory: document.getElementById('article-subcategory').value,
                        journal: document.getElementById('article-journal').value,
                        doi: document.getElementById('article-doi').value,
                        abstract: document.getElementById('article-abstract').value,
                        fileLink: document.getElementById('article-file-link').value,
                        thumbnailLink: document.getElementById('article-thumbnail-link').value,
                        content: document.getElementById('article-content').value,
                        status: document.getElementById('article-status').value,
                        language: document.getElementById('article-language').value,
                        access: document.getElementById('article-access').value,
                        tags: document.getElementById('article-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
                    };

                    const articleId = form.dataset.articleId;
                    if (articleId) {
                        await window.BlogData.updateArticle(articleId, article);
                        showSuccessAlert('Artigo atualizado com sucesso!');
                    } else {
                        await window.BlogData.addArticle(article);
                        showSuccessAlert('Artigo adicionado com sucesso!');
                    }

                    const modal = bootstrap.Modal.getInstance(document.getElementById('uploadArticleModal'));
                    modal.hide();
                    loadArticles();
                    refreshRecentArticlesList();
                    updateDashboardCounts();
                } catch (error) {
                    showErrorAlert('Erro ao salvar artigo: ' + (error.message || 'Tente novamente.'));
                } finally {
                    saveBtnText.classList.remove('d-none');
                    saveBtnLoading.classList.add('d-none');
                    this.disabled = false;
                }
            });

            // Configurar o botão de novo evento
            document.getElementById('new-event-btn').addEventListener('click', function() {
                document.getElementById('event-form').reset();
                document.getElementById('event-form').dataset.eventId = '';
                document.getElementById('uploadEventModalLabel').textContent = 'Novo Evento';
                const modal = new bootstrap.Modal(document.getElementById('uploadEventModal'));
                modal.show();
            });

            // Configurar o botão de salvar evento
            document.getElementById('save-event-btn').addEventListener('click', async function() {
                const form = document.getElementById('event-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const saveBtnText = document.getElementById('save-event-btn-text');
                const saveBtnLoading = document.getElementById('save-event-btn-loading');
                saveBtnText.classList.add('d-none');
                saveBtnLoading.classList.remove('d-none');
                this.disabled = true;

                try {
                    const event = {
                        title: document.getElementById('event-title').value,
                        eventDate: document.getElementById('event-date').value,
                        location: document.getElementById('event-location').value,
                        category: document.getElementById('event-category').value,
                        eventType: document.getElementById('event-type').value,
                        description: document.getElementById('event-description').value,
                        imageLink: document.getElementById('event-image-link').value,
                        link: document.getElementById('event-link').value
                    };

                    const eventId = form.dataset.eventId;
                    if (eventId) {
                        await window.BlogData.updateEvent(eventId, event);
                        showSuccessAlert('Evento atualizado com sucesso!');
                    } else {
                        await window.BlogData.addEvent(event);
                        showSuccessAlert('Evento adicionado com sucesso!');
                    }

                    const modal = bootstrap.Modal.getInstance(document.getElementById('uploadEventModal'));
                    modal.hide();
                    loadEvents();
                    updateDashboardCounts();
                } catch (error) {
                    showErrorAlert('Erro ao salvar evento: ' + (error.message || 'Tente novamente.'));
                } finally {
                    saveBtnText.classList.remove('d-none');
                    saveBtnLoading.classList.add('d-none');
                    this.disabled = false;
                }
            });

            // Configurar o botão de novo material
            document.getElementById('new-material-btn').addEventListener('click', function() {
                document.getElementById('material-form').reset();
                document.getElementById('material-form').dataset.materialId = '';
                document.getElementById('uploadMaterialModalLabel').textContent = 'Novo Material';
                const modal = new bootstrap.Modal(document.getElementById('uploadMaterialModal'));
                modal.show();
            });

            // Configurar o botão de salvar material
            document.getElementById('save-material-btn').addEventListener('click', async function() {
                const form = document.getElementById('material-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const saveBtnText = document.getElementById('save-material-btn-text');
                const saveBtnLoading = document.getElementById('save-material-btn-loading');
                saveBtnText.classList.add('d-none');
                saveBtnLoading.classList.remove('d-none');
                this.disabled = true;

                try {
                    const material = {
                        title: document.getElementById('material-title').value,
                        type: document.getElementById('material-type').value,
                        category: document.getElementById('material-category').value,
                        access: document.getElementById('material-access').value,
                        description: document.getElementById('material-description').value,
                        fileLink: document.getElementById('material-file-link').value,
                        coverLink: document.getElementById('material-cover-link').value
                    };

                    const materialId = form.dataset.materialId;
                    if (materialId) {
                        await window.BlogData.updateMaterial(materialId, material);
                        showSuccessAlert('Material atualizado com sucesso!');
                    } else {
                        await window.BlogData.addMaterial(material);
                        showSuccessAlert('Material adicionado com sucesso!');
                    }

                    const modal = bootstrap.Modal.getInstance(document.getElementById('uploadMaterialModal'));
                    modal.hide();
                    loadMaterials();
                    updateDashboardCounts();
                } catch (error) {
                    showErrorAlert('Erro ao salvar material: ' + (error.message || 'Tente novamente.'));
                } finally {
                    saveBtnText.classList.remove('d-none');
                    saveBtnLoading.classList.add('d-none');
                    this.disabled = false;
                }
            });

            // Configurar botões da seção de publicações
            document.getElementById('pub-article-btn').addEventListener('click', function() {
                document.getElementById('new-article-btn').click();
            });

            document.getElementById('pub-event-btn').addEventListener('click', function() {
                document.getElementById('new-event-btn').click();
            });

            document.getElementById('pub-material-btn').addEventListener('click', function() {
                document.getElementById('new-material-btn').click();
            });

            // Configurar filtros de eventos
            document.getElementById('apply-event-filters').addEventListener('click', filterEvents);
            document.getElementById('clear-event-filters').addEventListener('click', function() {
                document.getElementById('event-filter-category').value = '';
                document.getElementById('event-filter-type').value = '';
                document.getElementById('event-filter-date').value = '';
                loadEvents();
            });

            // Configurar filtros de materiais
            document.getElementById('apply-material-filters').addEventListener('click', filterMaterials);
            document.getElementById('clear-material-filters').addEventListener('click', function() {
                document.getElementById('material-filter-category').value = '';
                document.getElementById('material-filter-type').value = '';
                document.getElementById('material-filter-access').value = '';
                loadMaterials();
            });

            // Atualizar a data do último login
            const lastLogin = localStorage.getItem('lastLogin') || new Date().toISOString();
            document.getElementById('last-login-date').textContent = formatDate(lastLogin);
            localStorage.setItem('lastLogin', new Date().toISOString());
        });
    </script>
</body>
</html>